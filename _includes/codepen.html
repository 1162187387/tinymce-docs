{% comment %}

Makes an embedded editor example with tabs, including an "Edit on CodePen" tab.


params:

id (required). Picks folder for files, and used in css classes.
tab (optional - default to "run"), "run", "html", "css" or "js". The first tab to open.
height (optional - no default). min-height in pixels.

Files required under _includes/codepens/id/

index.html
index.js
index.css

{% endcomment %}


{% include tinymce-script-tag-once.html %}

{% capture codepen_html %}
{% include codepens/{{ include.id }}/index.html %}
{% endcapture %}

{% capture codepen_js %}
{% include codepens/{{ include.id }}/index.js %}
{% endcapture %}

{% capture codepen_css %}
{% include codepens/{{ include.id }}/style.css %}
{% endcapture %}

{% capture script_tag %}
{% include tinymce-script-tag.html %}
{% endcapture %}

{% capture codepen_html_preview %}
```html
{{ codepen_html }}
```
{% endcapture %}

{% capture codepen_js_preview %}
```js
{{ codepen_js }}
```
{% endcapture %}

{% capture codepen_css_preview %}
```css
{{ codepen_css }}
```
{% endcapture %}

{% if include.tab %}
    {% assign initialTab = include.tab %}
{% else %}
    {% assign initialTab = "run" %}
{% endif %}


<div id="codepen_{{ include.id }}" class="codepen" {% if include.height %}style="min-height:{{ include.height }}px;"{% endif %}>
    <div class="codepen_tabs">
        {% for tab in site.data.codepen-tabs %}
            {% if tab.name == initialTab %}
                {% assign class="codepen_tab_selected" %}
            {% else %}
                {% assign class="codepen_tab_deselected" %}
            {% endif %}
            <a href="#" id="codepen_tab_{{ tab.name }}_{{ include.id }}" class="{{ class }}">{{ tab.text }}</a>
        {% endfor %}

        <a href="#" id="codepen_tab_codepen_{{ include.id }}" class="codepen_tab_deselected">Edit on CodePen</a>
    </div>

    <div id="codepen_pane_run_{{ include.id }}" {% if "run" != initialTab %}style="display:none;"{% endif %}>
        <style type="text/css">
            {{ codepen_css }}
        </style>
        {{ codepen_html }}
    </div>

    <div id="codepen_pane_html_{{ include.id }}" {% if "html" != initialTab %}style="display:none;"{% endif %}>
        {{ codepen_html_preview | markdownify }}
    </div>

    <div id="codepen_pane_css_{{ include.id }}" {% if "css" != initialTab %}style="display:none;"{% endif %}>
        {{ codepen_css_preview | markdownify }}
    </div>

    <div id="codepen_pane_js_{{ include.id }}" {% if "js" != initialTab %}style="display:none;"{% endif %}>
        {{ codepen_js_preview | markdownify }}
    </div>
</div>

<form action="https://codepen.io/pen/define" method="POST" target="_blank" id="codepen_form_{{ include.id }}">
    <input type="hidden" name="data" id="codepen_data_{{ include.id }}" />
</form>

<script>
  var isIE = !!window.MSInputMethodContext && !!document.documentMode;

  if (isIE) {
    document.getElementsByClassName("codepen")[0].innerHTML =
      "<div style='background-color: #ededed; height: 30rem; display: flex; justify-content: center; align-items: center;'>" +
        "<div style='text-align: center'>" +
          '<svg width="48" height="48" xmlns="http://www.w3.org/2000/svg"><g transform="translate(1 1)" stroke="#FF307C" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"><circle cx="23" cy="23" r="23"/><path d="M12 18.5a.5.5 0 1 1 0 1 .5.5 0 0 1 0-1m22 0a.5.5 0 1 0 0 1 .5.5 0 0 0 0-1M14 37a9 9 0 0 1 18 0"/></g></svg>' +
          "<p style='color: #FF307C; font-weight: 600; margin-bottom: 0'>" +
            "Unfortunately, our demos no longer support Internet Explorer 11" +
          "</p>" +
          "<p style='font-size: 14px;'>" +
            "Don't worry, TinyMCE still works with Internet Explorer 11" +
          "</p>" +
        "</div>" +
      "</div>";
  } else {
    (function() {
      {{ codepen_js }}
    })();

    (function() {
      /* TODO: more js, less jekyll */
      var id = "{{ include.id }}";

      var html = decodeURIComponent("{{ codepen_html | uri_escape }}");
      var js = decodeURIComponent("{{ codepen_js | uri_escape }}");
      var css = decodeURIComponent("{{ codepen_css | uri_escape }}");

      /* Note: there are some other fields we could populate here to polish this. */
      /* See: https://blog.codepen.io/documentation/api/prefill/ */
      var data = {
        title: "TinyMCE Example",
        description: '',
        html: html,
        css: css,
        css_external: 'https://www.tiny.cloud/css/codepen.min.css',
        js: js,
        js_external: '{{ site.codepen_url }}'
      };
      document.getElementById("codepen_data_{{ include.id }}").value = JSON.stringify(data);

      /* TODO: */
      var tabs = ["run","html","css","js"].map(function(t) {
        return {
          tab: document.getElementById("codepen_tab_" + t + "_" + id),
          pane: document.getElementById("codepen_pane_" + t + "_" + id)
        };
      });

      tabs.forEach(function(t) {
        t.tab.onclick = function() {
          tabs.forEach(function(tt) {
            tt.pane.style.display = t === tt ? 'block' : 'none';
            tt.tab.className = t === tt ? 'codepen_tab_selected' : 'codepen_tab_deselected';
          });
          return false;
        };
      });

      document.getElementById("codepen_tab_codepen_" + id).onclick = function() {
        document.getElementById("codepen_form_" + id).submit();
      };

    })();
  }
</script>
